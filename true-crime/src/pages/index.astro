---
import Base from "@/layouts/Base.astro";
import HeadSEO from "@/components/HeadSEO.astro";
import PostCard from "@/components/PostCard.astro";
import { getCollection } from 'astro:content';

const allPosts = (await getCollection('posts', ({ data }) => !data.draft)).sort((a, b) => (a.data.date < b.data.date ? 1 : -1));
const heroPost = allPosts.find((p) => (p.data.tags || []).includes('ed-gein')) || allPosts[0];
const restPosts = allPosts.filter((p) => p.slug !== heroPost?.slug).slice(0, 12);
---
<Base title="True Crime â€“ Ed Gein" description="Latest posts and deep dives into true crime.">
  <HeadSEO title="True Crime" description="True crime stories and analysis" />

  {heroPost && (
    <section class="hero" style="margin: 1.5rem 0;">
      {heroPost.data.hero && <a href={`/blog/#${heroPost.slug}`}> <img src={heroPost.data.hero} alt={heroPost.data.title} /> </a>}
      <div class="content">
        <h2><a href={`/blog/#${heroPost.slug}`}>{heroPost.data.title}</a></h2>
        {heroPost.data.description && <p>{heroPost.data.description}</p>}
        <div class="tags">
          {(heroPost.data.tags || []).map((t) => <span class="tag">#{t}</span>)}
        </div>
      </div>
    </section>
  )}

  <section>
    <h2>Recent posts</h2>
    <div class="grid">
      {restPosts.map((p) => (
        <PostCard
          href={`/blog/#${p.slug}`}
          title={p.data.title}
          description={p.data.description}
          date={p.data.date}
          tags={p.data.tags}
        />
      ))}
    </div>
  </section>

</Base>


