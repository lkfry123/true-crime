---
import Base from "@/layouts/Base.astro";
import HeadSEO from "@/components/HeadSEO.astro";
import { getCollection } from 'astro:content';

const allPosts = (await getCollection('posts', ({ data }) => !data.draft)).sort((a, b) => (a.data.date < b.data.date ? 1 : -1));
const topThree = allPosts.slice(0, 3);
const topThreeRendered = await Promise.all(
  topThree.map(async (p) => {
    const rendered = await p.render();
    return { entry: p, Content: rendered.Content };
  })
);
---
<Base title="True Crime â€“ Ed Gein" description="Latest posts and deep dives into true crime.">
  <HeadSEO title="True Crime" description="True crime stories and analysis" />

  <section style="margin: 1.5rem 0;">
    <h2>Latest</h2>
    {topThreeRendered.map(({ entry: p, Content }) => (
      <article class="card" style="margin: 1rem 0;">
        <header>
          <h2 style="margin-bottom:.25rem;"><a href={`/blog/${p.slug}/`}>{p.data.title}</a></h2>
          <p style="color:var(--muted); font-size:.95rem;">{new Date(p.data.date).toLocaleDateString()}</p>
          {p.data.hero && <img src={p.data.hero} alt={p.data.title} />}
        </header>
        <div style="margin-top:.75rem;">
          <Content />
        </div>
      </article>
    ))}
  </section>

</Base>


