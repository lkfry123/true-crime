---
import Base from "@/layouts/Base.astro";
import HeadSEO from "@/components/HeadSEO.astro";
import { getCollection } from 'astro:content';
import SocialShare from "@/components/SocialShare.astro";
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('posts', ({ data }) => !data.draft);
  return posts.map((post) => ({ params: { slug: post.slug }, props: { post } }));
}

const { post } = Astro.props as { post: CollectionEntry<'posts'> };
const title = post.data.title;
const description = post.data.description || '';
const canonical = post.data.canonical || `/blog/${post.slug}/`;
const { Content } = await post.render();
---
<Base title={title} description={description}>
  <HeadSEO title={title} description={description} canonical={canonical} image={post.data.hero} type="article" publishedTime={post.data.date} />
  <article>
    <header style="margin-bottom:1rem;">
      <h1>{title}</h1>
      <p style="color:var(--muted);">{new Date(post.data.date).toLocaleDateString()} {post.data.author && `Â· ${post.data.author}`}</p>
      {post.data.hero && <img src={post.data.hero} alt={title} />}
    </header>
    <SocialShare title={title} url={(new URL(Astro.url.pathname, Astro.site || 'https://edgein.netlify.app')).toString()} />
    <div>
      <Content />
    </div>
  </article>
</Base>


