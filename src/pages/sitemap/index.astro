---
import Base from "@/layouts/Base.astro";
import HeadSEO from "@/components/HeadSEO.astro";
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts', ({ data }) => !data.draft))
  .sort((a, b) => (a.data.date < b.data.date ? 1 : -1));
const tagSet = new Set(posts.flatMap((p) => p.data.tags || []));
const tags = Array.from(tagSet).sort((a, b) => a.localeCompare(b));
---
<Base title="Sitemap" description="Organized list of all pages, posts, and tags">
  <HeadSEO title="Sitemap" description="Organized list of all pages, posts, and tags" canonical="/sitemap/" />

  <h1>Sitemap</h1>

  <section class="card" style="margin-top:1rem; padding:1rem;">
    <h2>Core pages</h2>
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="/blog/">Blog</a></li>
      <li><a href="/tags/ed-gein/">#ed-gein</a></li>
    </ul>
  </section>

  <section class="card" style="margin-top:1rem; padding:1rem;">
    <h2>All posts</h2>
    <ul>
      {posts.map((p) => (
        <li>
          <a href={`/blog/${p.slug}/`}>{p.data.title}</a>
          <span style="color:var(--muted);"> â€” {new Date(p.data.date).toLocaleDateString()}</span>
        </li>
      ))}
    </ul>
  </section>

  <section class="card" style="margin-top:1rem; padding:1rem;">
    <h2>Tags</h2>
    <div class="tags" style="margin-top:.5rem;">
      {tags.map((t) => (
        <a class="tag" href={`/tags/${t}/`}>#{t}</a>
      ))}
    </div>
  </section>

</Base>


